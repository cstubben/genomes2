##Taxonomy portals

enaPortal <-function(tax, portal="study", subtree=TRUE, limit =1000)
{
   if( length(tax) > 1){tax <- tax[1]; print("Warning: only the first id will be used")}
   #check if number passed as character, eg  2  = "2"
   if(!is.na(suppressWarnings(as.numeric( tax)))){ tax <-as.numeric(tax) }
   if(!is.numeric(tax)){ tax <- tax2id(tax)  }
   url1 <- "http://www.ebi.ac.uk/ena/data/view/Taxon:"
   url <- paste( url1, tax, "&portal=", portal, "&limit=", limit, "&display=xml", sep="")
    if(subtree) url<- paste(url, "&subtree=true", sep="")

   print(paste("Downloading XML from", url))

   x <- readLines(url, encoding="latin1")
   connecterror <- grepl("ERROR", x)
   if (any(connecterror)) {
     print(paste("Error connecting to NCBI ", x[connecterror]))
   }

  ## added Feb 5, 2013 - urls may be empty
   if(length(x)==0){
      print("No results found")
   }else if(length(x) == 2 ){
     # OR may return Result not found 
      print("Result not found.") 
   } else{
      ##Avoid error : Extra content at the end of the document
      x <-c("<ENA>", x, "</ENA>")
      doc <- xmlParse(x)
   }
}


